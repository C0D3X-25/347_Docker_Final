<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
        />
        <title>Inscription | Floppy Whale</title>
        <link
            rel="shortcut icon"
            href="{{ url_for('static', filename='assets/whale.png') }}"
            type="image/x-icon"
        />
        <link
            rel="stylesheet"
            href="{{ url_for('static', filename='styles/connection.css') }}"
        />
    </head>
    <body>
        <a
            class="leaderboard-link"
            onclick="goToLeaderboard()"
            aria-label="Voir le leaderboard"
        >
            <svg viewBox="0 0 24 24" role="img" aria-hidden="true">
                <path
                    d="M15 21H9V12.6C9 12.2686 9.26863 12 9.6 12H14.4C14.7314 12 15 12.2686 15 12.6V21Z"
                ></path>
                <path
                    d="M20.4 21H15V18.1C15 17.7686 15.2686 17.5 15.6 17.5H20.4C20.7314 17.5 21 17.7686 21 18.1V20.4C21 20.7314 20.7314 21 20.4 21Z"
                ></path>
                <path
                    d="M9 21V16.1C9 15.7686 8.73137 15.5 8.4 15.5H3.6C3.26863 15.5 3 15.7686 3 16.1V20.4C3 20.7314 3.26863 21 3.6 21H9Z"
                ></path>
                <path
                    d="M10.8056 5.11325L11.7147 3.1856C11.8314 2.93813 12.1686 2.93813 12.2853 3.1856L13.1944 5.11325L15.2275 5.42427C15.4884 5.46418 15.5923 5.79977 15.4035 5.99229L13.9326 7.4917L14.2797 9.60999C14.3243 9.88202 14.0515 10.0895 13.8181 9.96099L12 8.96031L10.1819 9.96099C9.94851 10.0895 9.67568 9.88202 9.72026 9.60999L10.0674 7.4917L8.59651 5.99229C8.40766 5.79977 8.51163 5.46418 8.77248 5.42427L10.8056 5.11325Z"
                ></path>
            </svg>
            <span>Leaderboard</span>
        </a>
        <div id="water"></div>
        <main class="login-page">
            <div class="brand">
                <h1>Floppy Whale</h1>
                <p>Deep dive challenge</p>
            </div>
            <div class="card">
                <header class="card-header">
                    <div class="logo" aria-hidden="true">üê≥</div>
                    <h1>Inscription</h1>
                    <p class="subtitle">
                        Cr√©ez votre compte pour commencer √† jouer
                    </p>
                </header>

                {% if error %}
                <div
                    class="error-message"
                    id="register-error"
                    role="alert"
                    aria-live="polite"
                >
                    {{ error }}
                </div>
                {% endif %}

                <form
                    class="login-form"
                    action="/register"
                    method="post"
                    novalidate
                >
                    <label for="username">Nom d'utilisateur</label>
                    <input
                        id="username"
                        name="username"
                        type="text"
                        placeholder="username"
                        required
                    />

                    <label for="password">Mot de passe</label>
                    <input
                        id="password"
                        name="password"
                        type="password"
                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                        required
                        minlength="6"
                    />

                    <button type="submit" class="btn-primary">
                        S'inscrire
                    </button>
                </form>

                <footer class="card-footer">
                    <p>D√©j√† un compte ? <a href="/login">Se connecter</a></p>
                </footer>
            </div>

            <img
                id="island"
                src="{{ url_for('static', filename='assets/island.svg') }}"
                alt=""
                aria-hidden="true"
            />

            <img
                id="boat"
                src="{{ url_for('static', filename='assets/boat.png') }}"
                alt=""
                aria-hidden="true"
            />
        </main>
        <script>
            const boat = document.getElementById("boat");

            const BOAT_SPEED = 60; // px per second

            let boatAnimationFrame = null;
            let boatPosition = 0;
            let lastBoatTimestamp = null;

            const goToLeaderboard = () => {
                window.location.href = "/leaderboard";
            };

            const getBoatWidth = () => {
                if (!boat) return 0;
                return (
                    boat.getBoundingClientRect().width ||
                    boat.naturalWidth ||
                    160
                );
            };

            const resetBoatPosition = () => {
                if (!boat) return;
                boatPosition = -getBoatWidth();
                boat.style.left = `${boatPosition}px`;
            };

            const animateBoat = (timestamp) => {
                if (!boat) return;
                if (lastBoatTimestamp === null) {
                    lastBoatTimestamp = timestamp;
                }

                const delta = timestamp - lastBoatTimestamp;
                lastBoatTimestamp = timestamp;

                boatPosition += (BOAT_SPEED * delta) / 1000;
                const travelSpan = window.innerWidth + getBoatWidth();

                if (boatPosition > travelSpan) {
                    resetBoatPosition();
                } else {
                    boat.style.left = `${boatPosition}px`;
                }

                boatAnimationFrame = requestAnimationFrame(animateBoat);
            };

            const startBoatAnimation = () => {
                if (!boat || boatAnimationFrame) return;
                resetBoatPosition();
                boatAnimationFrame = requestAnimationFrame(animateBoat);
            };

            if (boat) {
                if (boat.complete) {
                    startBoatAnimation();
                } else {
                    boat.addEventListener("load", startBoatAnimation, {
                        once: true,
                    });
                }
            }
        </script>
    </body>
</html>
